<TaskDefinition created="1712931226296" id="0ae840d58eca1ac1818ed2a842b80d96" modified="1761315579560" name="SLF Master CodeDynamo" resultAction="Rename" significantModified="1761315579560" subType="task_item_type_generic" type="Generic">
  <Attributes>
    <Map>
      <entry key="TaskDefinition.runLengthAverage" value="1254"/>
      <entry key="TaskDefinition.runLengthTotal" value="86543"/>
      <entry key="TaskDefinition.runs" value="69"/>
      <entry key="TaskSchedule.host" value="cl0a3329"/>
      <entry key="ruleName" value="SLF_Rule_CodeDynamo_Automation"/>
      <entry key="taskCompletionEmailNotify" value="Disabled"/>
      <entry key="taskCompletionEmailRecipients"/>
      <entry key="taskCompletionEmailTemplate"/>
    </Map>
  </Attributes>
  <Description>Name : SLF_Rule_CodeDynamo_Automation
Project : Code Dynamo
Developer : Hemanth Raj, K B
Dated : 03-25-2024
Objects :
1. Custom :  SLF_Custom_CodeDynamo
2. Email Template :  SLF_Emailtemplate_CodeDynamo_Notification
3. Task Definition :  SLF CodeDynamo
4. Rule Library` :  SLF_RuleLibrary_Generic_Utils
5. Task Definition :  SLF Master CodeDynamo
Description : 
This Rule is used to perform the below Operations
1. Create the Folder with the Today's Date. If there is a folder exist then append number at the end
2. Invoke the CodeDynamo task with the newly created Folder. and its configurations.
3. Validate the Task Completion. If error send an email and don't proceed further
4. No Error, then go ahead on Zip of Entire Folder
5. Delete the Folder with all the Files. Just store the compressed one.
6. Delete all Files on Recycle-bin
7. Validate the Zip files based on modified date, if more than retention period move to Recycle-bin
8. Send an detailed email, containing, Folder Zip created, HostName, Total Objects, Files deleted on Recycle-bin and Files moved to recyclebin.</Description>
  <Owner>
    <Reference class="sailpoint.object.Identity" id="0ae840e58deb1451818e5ffeae616d07" name="ZI56"/>
  </Owner>
  <Parent>
    <Reference class="sailpoint.object.TaskDefinition" id="1f5045a150fc9c200150fc9d78570194" name="Run Rule"/>
  </Parent>
</TaskDefinition>
 
<TaskDefinition created="1712931226280" id="0ae840d58eca1ac1818ed2a842a80d94" modified="1761315474204" name="SLF CodeDynamo" resultAction="Rename" significantModified="1761315474204" subType="task_item_type_generic" type="Generic">
  <Attributes>
    <Map>
      <entry key="TaskDefinition.runLengthAverage" value="1064"/>
      <entry key="TaskDefinition.runLengthTotal" value="1064"/>
      <entry key="TaskDefinition.runs" value="1"/>
      <entry key="TaskSchedule.host" value="cl0a3329"/>
      <entry key="addCData" value="true"/>
      <entry key="basePath" value="/apps/codeDynamo/dynamoSAMExport/24-10-2025-10-00-09"/>
      <entry key="classNames" value="default,CertificationDefinition"/>
      <entry key="pluginName" value="ObjectExporter"/>
      <entry key="removeIDs" value="true"/>
      <entry key="stripMetadata" value="true"/>
      <entry key="taskCompletionEmailNotify" value="Disabled"/>
      <entry key="taskCompletionEmailRecipients"/>
      <entry key="taskCompletionEmailTemplate"/>
    </Map>
  </Attributes>
  <Description>Export XML of IdentityIQ objects.</Description>
  <Owner>
    <Reference class="sailpoint.object.Identity" id="0ae840e58deb1451818e5ffeae616d07" name="ZI56"/>
  </Owner>
  <Parent>
    <Reference class="sailpoint.object.TaskDefinition" id="9fd0c6ac82011c1f81821c5f761d5037" name="XML Object Exporter"/>
  </Parent>
</TaskDefinition>
 
 
<Custom created="1712931226310" id="0ae840d58eca1ac1818ed2a842c60d98" modified="1761314410115" name="SLF_Custom_CodeDynamo" significantModified="1761314410115">
  <Attributes>
    <Map>
      <entry key="codeDynamoTaskArgs">
        <value>
          <Map>
            <entry key="TaskSchedule.host" value="cl0a3329"/>
            <entry key="addCData" value="true"/>
            <entry key="basePath" value="/apps/codeDynamo/dynamoSAMExport/24-10-2025-10-00-09"/>
            <entry key="classNames" value="default,CertificationDefinition"/>
            <entry key="pluginName" value="ObjectExporter"/>
            <entry key="removeIDs" value="true"/>
            <entry key="stripMetadata" value="true"/>
            <entry key="taskCompletionEmailNotify" value="Disabled"/>
            <entry key="taskCompletionEmailRecipients"/>
            <entry key="taskCompletionEmailTemplate"/>
          </Map>
        </value>
      </entry>
      <entry key="hostName" value="cl0a3329"/>
      <entry key="taskClassNames" value="default,CertificationDefinition"/>
      <entry key="taskURL" value="https://sit-sam.ca.sunlife/identityiq/monitor/tasks/renderResults.jsf?TaskResultId="/>
    </Map>
  </Attributes>
</Custom>
 
 
<EmailTemplate bcc="K.B.Hemanth.Raj@sunlife.com" created="1712931225789" id="0ae840d58eca1ac1818ed2a840bd0d92" modified="1719416630440" name="SLF_Emailtemplate_CodeDynamo_Notification">
  <Body>
    &lt;HTML>
    &lt;HEAD>
    &lt;TITLE>sunlife&lt;/TITLE>
    &lt;BASE TARGET=_blank>
    &lt;/HEAD>
    &lt;body>
&lt;b>This mailbox is not monitored and unable to receive any replies.&lt;/b>
    &lt;style type="text/css"> body{background-color:#fff8e0; font-family: Cambria, Georgia, serif; font-size:12pt} H1{color:#52247F; font-size:8pt } p{font-size:10pt} h2{color:#52247F; font-size:20pt; margin:auto;  border:1px solid red; color:red;} div.dev{font-size:9pt;} div.mainCon{font-size:12pt; font-family: Cambria, Georgia, serif; text-align: justify; } div.mainWarn{color:#8C001A; font-size:12pt; font-family: Cambria, Georgia, serif; text-align: justify; }
    &lt;/style>
 
    
 
#if($warningMessage)
&lt;center>&lt;h2>Action Required! &lt;/h2>&lt;/center>
    &lt;div class="mainCon">&lt;strong>$warningMessage&lt;/strong>&lt;/div>&lt;/br>
#end
 
&lt;div class="mainCon">Dear SAM Team,&lt;/div>&lt;/br>
    &lt;div class="mainCon">$!message &lt;/div>&lt;/br>
 
&lt;table border="1" align="center">
    &lt;tbody>
    &lt;tr>
    &lt;th style="background-color: #003946;"colspan="5">&lt;h3>&lt;font color="white">$!job Statistics &lt;/font>&lt;/h3>&lt;/th>
    &lt;/tr>
#if($timeStamp)
    &lt;tr>
    &lt;td align="center" style="width:50%">&lt;p>&lt;strong>Time Stamp&lt;/strong>&lt;/p>&lt;/td>&lt;td align="center" style="width:50%">&lt;p> $!timeStamp &lt;/p>&lt;/td>
    &lt;/tr>
#end
#if($serverInfo)
&lt;tr>
    &lt;td align="center" style="width:50%">&lt;p>&lt;strong>Server Information&lt;/strong>&lt;/p>&lt;/td>&lt;td align="center" style="width:50%">&lt;p> $!serverInfo &lt;/p>&lt;/td>
    &lt;/tr>
#end
#foreach($info in $moreInfo.keySet())
&lt;tr>
    &lt;td align="center" style="width:50%">&lt;p>&lt;strong>$info&lt;/strong>&lt;/p>&lt;/td>&lt;td align="center" style="width:50%">&lt;p> $moreInfo.get($info) &lt;/p>&lt;/td>
    &lt;/tr>
#end
 
    &lt;/tbody>
    &lt;/table>
 
&lt;/br>
&lt;/br>
 
 
#if($errorInfo)
&lt;table border="1" align="center">
    &lt;tbody>
    &lt;tr>
    &lt;th style="background-color: #003946;"colspan="5">&lt;h3>&lt;font color="white">Error On the Task&lt;/font>&lt;/h3>&lt;/th>
    &lt;/tr>
    &lt;tr>
#foreach ($item in $errorInfo)
    &lt;td align="justify" style="width:100%;">$item&lt;/td>
    &lt;/tr>
#end
&lt;/tbody>
    &lt;/table>
&lt;/br>
&lt;/br>
#end
 
 
#if($fileDeletedInRecycle)
&lt;table border="1" align="center">
    &lt;tbody>
    &lt;tr>
    &lt;th style="background-color: #003946;"colspan="5">&lt;h3>&lt;font color="white">Files Deleted on Recycle Bin&lt;/font>&lt;/h3>&lt;/th>
    &lt;/tr>
    &lt;tr>
#foreach ($item in $fileDeletedInRecycle)
    &lt;td align="justify" style="width:100%;">$item&lt;/td>
    &lt;/tr>
#end
&lt;/tbody>
    &lt;/table>
&lt;/br>
&lt;/br>
#end
 
 
#if($fileMovedToRecycle)
&lt;table border="1" align="center">
    &lt;tbody>
    &lt;tr>
    &lt;th style="background-color: #003946;"colspan="5">&lt;h3>&lt;font color="white">Files Moved to Recycle Bin Statistics &lt;/font>&lt;/h3>&lt;/th>
    &lt;/tr>
 
#foreach($info in $fileMovedToRecycle.keySet())
&lt;tr>
    &lt;td align="center" style="width:50%">&lt;p>&lt;strong>$info&lt;/strong>&lt;/p>&lt;/td>&lt;td align="center" style="width:50%">&lt;p> $fileMovedToRecycle.get($info) &lt;/p>&lt;/td>
    &lt;/tr>
#end
 
    &lt;/tbody>
    &lt;/table>
&lt;/br>
&lt;/br>
#end
 
&lt;div class="mainWarn">Note: &lt;strong>Be caution on Re-Running the task, because this will permanently delete all the previous files from the Recycle Bin on the server&lt;/strong>&lt;/div>&lt;/br>
 
&lt;div class="mainCon">
    If you require further assistance, kindly email the &lt;a href="mailto:ASCI.InfoSec.DBTS@sunlife.com" style="color:#52247F;">Sailpoint Developer Team&lt;/a>.
    &lt;/div>&lt;/br>
 
    &lt;div class="mainCon">Regards,&lt;/br>
    &lt;strong>IAM Platform Team&lt;/strong>&lt;/div>&lt;/br>
 
&lt;div class="dev">Developed by &lt;strong>K B Hemanth Raj&lt;/strong>&lt;/div>
 
    &lt;/BODY>
    &lt;/HTML>
  </Body>
  <Description>
    Email Template for the Code Dynamo Manager. - developed by K B Hemanth Raj
  </Description>
  <Signature>
    <Inputs>
      <Argument name="job" type="String">
        <Description>Job Name - Business reason on Job Run.</Description>
      </Argument>
      <Argument name="message" type="String">
        <Description>Message to be displayed.</Description>
      </Argument>
      <Argument name="timeStamp" type="String">
        <Description>Time Stamp of the Error.</Description>
      </Argument>
      <Argument name="serverInfo" type="String">
        <Description>Job performed on Server.</Description>
      </Argument>
      <Argument name="moreInfo" type="Map">
        <Description>UncorelatedCount.</Description>
      </Argument>
      <Argument name="errorInfo" type="List">
        <Description>errorInfo.</Description>
      </Argument>
      <Argument name="fileDeletedInRecycle" type="List">
        <Description>fileDeletedInRecycle.</Description>
      </Argument>
      <Argument name="fileMovedToRecycle" type="Map">
        <Description>fileMovedToRecycle.</Description>
      </Argument>
    </Inputs>
  </Signature>
  <Subject>DO-NOT-REPLY:Alert - $!job</Subject>
</EmailTemplate>
 
 
<Rule created="1712931226319" id="0ae840d58eca1ac1818ed2a842cf0d99" language="beanshell" modified="1735919178851" name="SLF_Rule_CodeDynamo_Automation" significantModified="1735919178851">
  <ReferencedRules>
    <Reference class="sailpoint.object.Rule" id="0ae840e58deb1451818e5ffea8496cfd" name="SLF_RuleLibrary_Generic_Utils"/>
  </ReferencedRules>
  <Source>
  
/*
##########################################################################################
#
# Name : SLF_Rule_CodeDynamo_Automation
# Project : Code Dynamo
# Developer : Hemanth Raj, K B
# Dated : 03-25-2024
# Objects :
# 1. Custom :  SLF_Custom_CodeDynamo
# 2. Email Template :  SLF_Emailtemplate_CodeDynamo_Notification
# 3. Task Definition :  SLF CodeDynamo
# 4. Rule Library` :  SLF_RuleLibrary_Generic_Utils
# 5. Task Definition :  SLF Master CodeDynamo
# Description : 
# This Rule is used to perform the below Operations
# 1. Create the Folder with the Today's Date. If there is a folder exist then append number at the end
# 2. Invoke the CodeDynamo task with the newly created Folder. and its configurations.
# 3. Validate the Task Completion. If error send an email and don't proceed further
# 4. No Error, then go ahead on Zip of Entire Folder
# 5. Delete the Folder with all the Files. Just store the compressed one.
# 6. Delete all Files on Recycle-bin
# 7. Validate the Zip files based on modified date, if more than retention period move to Recycle-bin
# 8. Send an detailed email, containing, Folder Zip created, HostName, Total Objects, Files deleted on Recycle-bin and Files moved to recyclebin.
#
##########################################################################################
*/
    import sailpoint.api.TaskManager;
import sailpoint.object.TaskResult;
import sailpoint.object.TaskResult.CompletionStatus;
import sailpoint.object.TaskItem;
import sailpoint.object.TaskDefinition;
import sailpoint.object.Custom;
import sailpoint.object.Attributes;
import java.text.SimpleDateFormat;
import sailpoint.tools.Message;
 
log.error("\n\n\nStart of SLF_Rule_CodeDynamo_Automation:");
List errorMessage = new ArrayList();
List successMessage = new ArrayList();
List fileDeletedInRecycle = new ArrayList();
Map fileMovedToRecycle = new HashMap();
int codeDynamoRetentionDays = -90;
int codeDynamoFileMoved = 1;
SimpleDateFormat sdf = new SimpleDateFormat("MM/dd/yyyy HH:mm:ss");
String codeDynamoRootPath = "/apps/codeDynamo/";
String codeDynamoGeneratePath = codeDynamoRootPath + "dynamoSAMExport/";
String codeDynamoCompressPath = codeDynamoRootPath + "dynamoSAMCompress/";
String codeDynamoRecycleBinPath = codeDynamoRootPath + "dynamoRecycleBin/";
String codeDynamoJobName = "SAM Code Dynamo";
String codeDynamoTaskName = "SLF CodeDynamo";
String codeDynamoWorkGroupName = "Security - Specialist";
String codeDynamoCustomName = "SLF_Custom_CodeDynamo";
String codeDynamoEmailTemplate = "SLF_Emailtemplate_CodeDynamo_Notification";
String codeDynamoCurrentFolder = getCurrentDateHyphen();
String codeDynamoTaskExportPath = codeDynamoGeneratePath + codeDynamoCurrentFolder;
String codeDynamoTaskURL = "http://localhost:8080/IdentityIQ/monitor/tasks/renderResults.jsf?TaskResultId=";
String codeDynamoTaskURLID = codeDynamoTaskURL;
String codeDynamoCurrentServerInfo = getCurrentServerAddress();
String codeDynamoCompressFile = "";
String codeDynamoExpectedServerName = null;
Custom codeDynamoCustom = context.getObjectByName(Custom.class,codeDynamoCustomName);
boolean validServerSelected = false;
 
    try
{
//Validate the Server Name if its running on that same Server
if(null!=codeDynamoCustom.get("hostName"))
codeDynamoExpectedServerName = codeDynamoCustom.get("hostName");
 
if(null!=codeDynamoExpectedServerName &amp;&amp; codeDynamoExpectedServerName.equals(codeDynamoCurrentServerInfo))
{
validServerSelected = true;
}
else
{
errorMessage.add("Code Dynamo is intended to run on server - "+codeDynamoExpectedServerName+" - however ran on server - "+codeDynamoCurrentServerInfo);
}
 
//Intially check if these folders are being created
if( validServerSelected &amp;&amp; validateFolder(codeDynamoRootPath) &amp;&amp; (validateFolder(codeDynamoRecycleBinPath) &amp;&amp; validateFolder(codeDynamoCompressPath) &amp;&amp; validateFolder(codeDynamoGeneratePath)) )
{
 
//delete everything on recyclebin
File directoryPathRB = new File(codeDynamoRecycleBinPath);
log.error("directoryPathRB:"+directoryPathRB);
if(directoryPathRB.isDirectory())
{
File[] filesListRB = directoryPathRB.listFiles();
//log.error("filesListRB:"+filesListRB);
for(File file : filesListRB) 
{
if(file.isFile())
{
boolean deleteResult = false;
String filePath = file.getPath();
if(file.canWrite())
{
deleteResult = file.delete();
}
if(deleteResult)
fileDeletedInRecycle.add(filePath);
else
errorMessage.add("Unable to delete the File in Recycle Bin for :"+filePath);
}
}
}
else
{
errorMessage.add("Invalid Recycle Bin Path :"+recycleBinPath);
}
 
//plugin Version 4.2.0
TaskManager taskM = new TaskManager(context);
log.error("taskM:"+taskM);
Map taskArg = new HashMap();
TaskDefinition taskDefinition = context.getObjectByName(TaskDefinition.class,codeDynamoTaskName);
 
if(null!=taskDefinition &amp;&amp; null!=codeDynamoCustom)
{
Map codeDynamoArg = new HashMap();
codeDynamoArg = codeDynamoCustom.get("codeDynamoTaskArgs");
if(null!=codeDynamoCustom.get("taskURL"))
codeDynamoTaskURL = codeDynamoCustom.get("taskURL");
else
errorMessage.add("unable to find the task URL");
if(null!=codeDynamoCustom.get("hostName"))
{
codeDynamoArg.put("TaskSchedule.host",codeDynamoCustom.get("hostName"));
}
else
{
errorMessage.add("No Host Name is configured.");
}
if(null!=codeDynamoCustom.get("taskClassNames"))
{
codeDynamoArg.put("classNames",codeDynamoCustom.get("taskClassNames"));
}
else
{
codeDynamoArg.put("classNames","default");
errorMessage.add("No Class Name is configured. using default classes.");
}
if(null!=codeDynamoTaskExportPath &amp;&amp; validateFolder(codeDynamoTaskExportPath))
{
successMessage.add("Folder Created for path: "+codeDynamoTaskExportPath);
codeDynamoArg.put("basePath",codeDynamoTaskExportPath);
}
else
{
errorMessage.add("Unable to create the Folder on the Export Path: "+codeDynamoTaskExportPath);
}
taskDefinition.setArguments(new Attributes(codeDynamoArg));
TaskResult plugintaskResult = taskM.runSync(taskDefinition,taskArg);
log.error("isComplete()"+plugintaskResult.isComplete());
log.error("isError()"+plugintaskResult.isError());
log.error("isLive()"+plugintaskResult.isLive());
log.error("isSuccess()"+plugintaskResult.isSuccess());
log.error("isTerminated()"+plugintaskResult.isTerminated());
log.error(" hasErrors()"+plugintaskResult.hasErrors());
log.error("hasWarnings()"+plugintaskResult.hasWarnings());
log.error("getHost"+plugintaskResult.getHost());
List taskResultMessages = plugintaskResult.getMessages();
log.error("taskResultMessages:"+taskResultMessages);
if(plugintaskResult.isComplete() &amp;&amp; plugintaskResult.isSuccess())
{
successMessage.add("Plugin Task Host Name: "+plugintaskResult.getHost());
successMessage.add("Plugin Task Ran Successfully");
successMessage.add("For More info: "+codeDynamoTaskURL+plugintaskResult.getId());
codeDynamoTaskURLID = codeDynamoTaskURL+plugintaskResult.getId();
 
codeDynamoCompressFile = codeDynamoCompressPath+codeDynamoCurrentFolder+".zip";
boolean resultZip = zipDirectory(codeDynamoTaskExportPath,codeDynamoCompressFile);
if(resultZip)
{
successMessage.add("Compress is completed on Path:"+codeDynamoCompressFile);
deleteEntireDirectory(new File(codeDynamoTaskExportPath));
successMessage.add("Deleted Entire exported Files: "+codeDynamoTaskExportPath);
 
//Compress Path modified movement
 
long internalFileAllowedDays = getModifiedDate(codeDynamoRetentionDays).getTime();
log.error("\n---Start of Compress Path Validation---\n"+internalFileAllowedDays);
File directoryPath = new File(codeDynamoCompressPath);
if(directoryPath.isDirectory())
{
File[] filesList = directoryPath.listFiles();
 
//log.error("List of files and directories in the specified directory: "+filesList);
log.error("total files "+filesList.length);
for(File file : filesList) 
{
if(file.isFile())
{
String fileName = file.getName();
String filePath = file.getPath();
//log.error("\n---Starting File validation for : "+fileName);
long fileModified = file.lastModified();
//log.error("File fileModified:"+fileModified);
if((Long.compare(fileModified, internalFileAllowedDays))&lt;0)
{
 
String fullTmpFile = codeDynamoRecycleBinPath+fileName+"-RB-on-"+getCurrentDateHyphen()+"-"+codeDynamoFileMoved+".tmp";
boolean result = false;
//log.error("File retention Date exceed:"+fullTmpFile);
 
if(file.canWrite())
{
result = file.renameTo(new File(fullTmpFile));
}
 
if(result)
{
fileMovedToRecycle.put(filePath,sdf.format(fileModified));
codeDynamoFileMoved++;
}
else
{
errorMessage.add("Unable to move the File for Internal Criteria on :"+filePath);
}
}
}
}
}
else
{
errorMessage.add("Invalid Directory configuration for DateCriteria on :"+dirPath);
}
 
 
//return fileMovedToRecycle;
 
 
 
 
 
}
else
{
errorMessage.add("Unable to compress on Path:"+codeDynamoCompressFile);
errorMessage.add("Halting further process");
}
 
}
else
{
errorMessage.add("Plugin Task Host Name: "+plugintaskResult.getHost());
errorMessage.add("Plugin Task is a failure");
errorMessage.add("For More info: "+codeDynamoTaskURL+plugintaskResult.getId());
errorMessage.add("Halting further process");
}
 
}
else
{
if(null==taskDefinition)
errorMessage.add("Task Definition is not found: "+ codeDynamoTaskName);
if(null==codeDynamoCustom)
errorMessage.add("Custom Object is not found: "+ codeDynamoCustomName);
}
}
else
{
if(validServerSelected)
errorMessage.add("unable to create the directory for Code Dynamo");
else
errorMessage.add("Halting the Process, Since this is not the destignated Server");
}
 
successMessage.add("deleted - "+fileDeletedInRecycle);
successMessage.add("moved - "+fileMovedToRecycle);
 
 
 
 
 
    }
catch (Exception e)
{
log.error("Exception on Main Call of SLF_Rule_CodeDynamo_Automation :"+e.getMessage());
errorMessage.add("Exception on Main Call of SLF_Rule_CodeDynamo_Automation :"+e.getMessage());
    }
 
 
Map args1 = new HashMap();
Map args2 = new HashMap();
Map emailSenders = new HashMap();
 
args1.put("job",codeDynamoJobName);
args1.put("serverInfo",codeDynamoCurrentServerInfo);
args1.put("timeStamp",getCurrentDate());
if(codeDynamoFileMoved>1)
args1.put("warningMessage","Some Files have been moved to the Recycle Bin, Kindly review and restore, if necessary, before they get deleted in the next execution.");
 
if(null!=errorMessage &amp;&amp; !errorMessage.isEmpty())
args1.put("warningMessage","There is an error. Kindly work on fixing the error before running the task again");
 
args1.put("message","Code Dynamo ran on Server "+codeDynamoCurrentServerInfo+". The task created a code backup and compressed it. See below for more information. The task will automatically move the files older than "+codeDynamoRetentionDays+" days to Recycle Bin. In the next run, the task will permanently delete these files from the Recycle Bin. Kindly ensure you validate all the files that got moved into the Recycle Bin." );
args2.put("Code Dynamo Plugin Task Results",codeDynamoTaskURLID);
if(null!=taskResult.getId())
args2.put("Master Code Dynamo Task Results",codeDynamoTaskURL+taskResult.getId());
args2.put("Recycle Bin Directory",codeDynamoRecycleBinPath);
args2.put("Code Dynamo Compress Directory",codeDynamoCompressPath);
args2.put("Code Dynamo Compress Path for current Run",codeDynamoCompressFile);
args2.put("Code Dynamo Plugin Path for current Run",codeDynamoTaskExportPath);
args2.put("Total Number of File Moved to Recycle Bin",fileMovedToRecycle.size());
args2.put("Total Number of File Deleted in Recycle Bin",fileDeletedInRecycle.size());
 
args1.put("moreInfo",args2);
args1.put("errorInfo",errorMessage);
args1.put("fileDeletedInRecycle",fileDeletedInRecycle);
args1.put("fileMovedToRecycle",fileMovedToRecycle);
if(null!=getWorkGroupEmail(codeDynamoWorkGroupName) &amp;&amp; !getWorkGroupEmail(codeDynamoWorkGroupName).isEmpty())
emailSenders.put("TO",getWorkGroupEmail(codeDynamoWorkGroupName));
else
emailSenders.put("TO","SAM_Support@sunlife.com");
emailSenders.put("CC","ASCI.InfoSec.DBTS@sunlife.com");
sendEmail(args1, codeDynamoEmailTemplate, emailSenders);
 
if (taskResult.hasErrors())
{
  taskResult.setCompletionStatus(CompletionStatus.Error);
  taskResult.setMessages(errorMessage);
}
else if(!errorMessage.isEmpty())
{
String errorMessagetoDisplay = "Error:";
for(String a : errorMessage)
{
errorMessagetoDisplay = "Error:" + a;
taskResult.addMessage(Message.error(errorMessagetoDisplay));
}
}
taskResult.addMessage(new Message("Server Info : "+codeDynamoCurrentServerInfo, null));
taskResult.addMessage(new Message("Recycle Bin Directory : "+codeDynamoRecycleBinPath, null));
taskResult.addMessage(new Message("Code Dynamo Compress Directory : "+codeDynamoCompressPath, null));
taskResult.addMessage(new Message("Code Dynamo Compress Path for current Run : "+codeDynamoCompressFile, null));
taskResult.addMessage(new Message("Code Dynamo Plugin Path for current Run : "+codeDynamoTaskExportPath, null));
taskResult.addMessage(new Message("Total Number of File Moved to Recycle Bin : "+fileMovedToRecycle.size(), null));
taskResult.addMessage(new Message("Total Number of File Deleted in Recycle Bin : "+fileDeletedInRecycle.size(), null));
taskResult.addMessage(new Message("Kindly refer to the E-Mail sent to know more on Code Dynamo", null));
 
 
if(null!=errorMessage &amp;&amp; !errorMessage.isEmpty())
return errorMessage;
return successMessage;
 
 
    
    </Source>
</Rule>